<!DOCTYPE html>
<html lang="en">

<head>
            <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="google-site-verification" content="g0zsBLTsA4E4l1gZ8fQL_DlYMi4nVFIY_zMUUHCvKMI">
        <title>Theo dõi còn bao nhiêu thời gian xe bus đến điểm dừng</title>

        <!-- Bootstrap Core CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <!-- Custom CSS -->
        <!-- <link href="https://cuccode.com/theme/css/clean-blog.min.css" rel="stylesheet"> -->
        <link href="https://cuccode.com/theme/css/clean-blog.css" rel="stylesheet">

        <!-- Code highlight color scheme -->
        <link href="https://cuccode.com/theme/css/code_blocks/monokai.css" rel="stylesheet">


        <!-- Custom Fonts -->
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->



        <meta name="description" content="Theo dõi còn bao nhiêu thời gian xe bus đến điểm dừng">

        <meta name="author" content="dangsonbk">

        <meta name="tags" content="hanoi">
        <meta name="tags" content="bus">
        <meta name="tags" content="python">

	        <meta property="og:locale" content="">
        <meta property="og:site_name" content="cuccode">

	<meta property="og:type" content="article">
            <meta property="article:author" content="https://cuccode.com/author/dangsonbk.html">
	<meta property="og:url" content="https://cuccode.com/incoming_bus_tracking.html">
	<meta property="og:title" content="Theo dõi còn bao nhiêu thời gian xe bus đến điểm dừng">
	<meta property="article:published_time" content="2019-02-15 20:30:00+07:00">
            <meta property="og:description" content="Theo dõi còn bao nhiêu thời gian xe bus đến điểm dừng">

            <meta property="og:image" content="https://cuccode.com/static/misc/HanoiBus.jpg">
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:site" content="@dangsonbk">
        <meta name="twitter:title" content="Theo dõi còn bao nhiêu thời gian xe bus đến điểm dừng">

            <meta name="twitter:image" content="https://cuccode.com/static/misc/HanoiBus.jpg">

            <meta name="twitter:description" content="Theo dõi còn bao nhiêu thời gian xe bus đến điểm dừng">
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <a class="navbar-brand" href="https://cuccode.com/"><span class="glyphicon glyphicon-home"></span> CucCode</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
            aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
        <div class="collapse navbar-collapse " id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">

                        <li><a  class="nav-link"  href="https://cuccode.com/category/bai-dich.html">Bài dịch</a></li>
                        <li class="active"><a  class="nav-link"  href="https://cuccode.com/category/misc.html">misc</a></li>
                        <li><a  class="nav-link"  href="https://cuccode.com/category/python.html">python</a></li>
                        <li><a  class="nav-link"  href="https://cuccode.com/category/smarthome.html">smarthome</a></li>
            </ul>
        </div>
    </nav>

    <!-- Page Header -->
        <header class="intro-header" style="background-image: url('https://cuccode.com/static/misc/HanoiBus.jpg')">
    </header>
    <div class="container">
        <div class="row">
            <div class="col-lg-8  mx-auto">
                <div class="post-heading">
                    <h1>Theo dõi còn bao nhiêu thời gian xe bus đến điểm dừng</h1>
                    
                </div>
            </div>
        </div>
        <span class="article-meta">Post by             <a href="https://cuccode.com/author/dangsonbk.html">dangsonbk</a>
 on 15-02-2019
        </span>
        <!-- Post Content -->
        <article>
            <p>Hồi sinh viên, phương tiện đi lại chính của mình là xe bus, đi làm rồi thì thi thoảng mới có dịp đi mặc dù rất muốn.</p>
<p>Có một câu chuyện hay gặp khi đợi xe đó là mặc dù đường vắng, lịch chạy 10 phút 1 chuyến thì thường bạn hay có cảm giác kém may mắn khi phải đợi lâu hơn 10 phút. Dĩ nhiên trừ hôm nào ra phát có xe luôn hoặc cắm đầu cắm cổ chạy vừa kịp lúc xe tới, còn không thì lúc nào cũng thấy mình đen đen.</p>
<p>Trước đây mình cũng chẳng để ý đến nó, thời sinh viên thì có quá nhiều thời gian rảnh mà, nhưng khi đi làm, có gia đình, có con rồi mới thấy thời gian đợi xe thực sự là quá lãng phí. Thời gian ấy mình có thể về sớm hơn để chơi với con thì tốt (thực ra là ở công ty reddit, 9gag muộn hơn :-) ).</p>
<blockquote>
<p>When waiting for a bus that comes on average every 10 minutes, your average waiting time will be 10 minutes.</p>
</blockquote>
<p>Cái vụ đợi xe và thấy mình đen đen kia thực ra có một nghịch lý gọi là Waiting Paradox để giải thích. Ai quan tâm có thể xem bài viết: <a href="https://jakevdp.github.io/blog/2018/09/13/waiting-time-paradox/">The Waiting Time Paradox, or, Why Is My Bus Always Late?</a>. Phần diễn giải thấy nhiều toán, nhiều chữ là mình sợ rồi, chỉ biết tóm gọn lại là: "Giả sử xe đến mỗi 10 phút, bạn đến điểm dừng một cách ngẫu nhiên, thì thời gian chờ xe trung bình của bạn là 10 phút".</p>
<p><img alt="Oh Math" src="static/misc/math.jpg"></p>
<p>Bây giờ, làm sao để tối giản thời gian đợi xe? Cách đơn giản nhất là căn thời gian bao giờ xe đến thì phi ra cửa checkout rồi chạy xuống. Để căn được thời gian này trong khi vẫn ngồi ịn ở công ty thì mình viết một đoạn script Python, track xem bao giờ xe bus tiếp theo sẽ đến thông qua API của <a href="http://timbus.vn">timbus</a>, một website của Transerco.</p>
<p>Phần hướng dẫn làm sao để mình viết được như thế thì sẽ diễn giải ở phần sau.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Referer&#39;</span><span class="p">:</span> <span class="s1">&#39;http://timbus.vn/&#39;</span><span class="p">,</span>
    <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.102 Safari/537.36 OPR/57.0.3098.116&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Origin&#39;</span><span class="p">:</span> <span class="s1">&#39;http://timbus.vn&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Accept-Encoding&#39;</span><span class="p">:</span> <span class="s1">&#39;gzip, deflate&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Accept-Language&#39;</span><span class="p">:</span> <span class="s1">&#39;en-GB,en-US;q=0.9,en;q=0.8&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/x-www-form-urlencoded; charset=UTF-8&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Accept&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json, text/javascript, */*; q=0.01&#39;</span><span class="p">,</span>
    <span class="s1">&#39;X-Requested-With&#39;</span><span class="p">:</span> <span class="s1">&#39;XMLHttpRequest&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Connection&#39;</span><span class="p">:</span> <span class="s1">&#39;keep-alive&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">(</span><span class="s1">&#39;act&#39;</span><span class="p">,</span> <span class="s1">&#39;partremained&#39;</span><span class="p">),</span>
  <span class="p">(</span><span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">),</span>
  <span class="p">(</span><span class="s1">&#39;StationID&#39;</span><span class="p">,</span> <span class="s1">&#39;586&#39;</span><span class="p">),</span>
  <span class="p">(</span><span class="s1">&#39;FleetOver&#39;</span><span class="p">,</span> <span class="s1">&#39;33&#39;</span><span class="p">),</span>
<span class="p">]</span>

<span class="k">while</span><span class="p">(</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;http://timbus.vn/Engine/Business/Vehicle/action.ashx&#39;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;dt&quot;</span><span class="p">])</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>


<p>Để lấy được API cũng như thông tin cần thiết để gửi lên server qua API này, mình dùng giao diện web thông thường, thả điểm đến, điểm đi, chọn phương án di chuyển cho đến khi có được bảng thông tin này:</p>
<p><img alt="findBusInMap" src="static/misc/findBusInMap.png"></p>
<p>Tiếp theo mình dùng công cụ Inspect của Chrome để bắt query lên server của web, copy cURL lại và convert sang code Python. Phần convert mình dùng công cụ tại <a href="https://curl.trillworks.com">https://curl.trillworks.com</a></p>
<p><img alt="copyCURL" src="static/misc/copyCURL.png"></p>
<p>Lưu code được convert ra từ <a href="https://curl.trillworks.com">curl.trillworks</a>, sửa đổi một chút chỉ lấy thông tin mình cần và ta có kết quả:</p>
<p><img alt="Done" src="static/misc/HanoiBusDone.png"></p>
<p>Giờ mình đang nghĩ, không biết app di động của <a href="http://timbus.vn">timbus</a> có tính năng báo bus gần đến không. Lười chưa cài xem nó thế nào. =))</p>
<p>Image: <a href="https://en.wikipedia.org/wiki/Buses_in_Hanoi">Wiki</a></p>
<hr>
<h3>Tham khảo:</h3>
<ul>
<li><a href="https://jakevdp.github.io/blog/2018/09/13/waiting-time-paradox/">The Waiting Time Paradox, or, Why Is My Bus Always Late?</a></li>
<li><a href="https://stats.stackexchange.com/questions/122722/please-explain-the-waiting-paradox">Please explain the waiting paradox</a></li>
</ul>
        </article>

            <div class="tags">
                <p>tags: <a href="https://cuccode.com/tag/hanoi.html">hanoi</a>, <a href="https://cuccode.com/tag/bus.html">bus</a>, <a href="https://cuccode.com/tag/python.html">python</a></p>
            </div>

    <hr>
    <div class="sharing">
        <!-- AddThis Button BEGIN -->
        <div class="addthis_toolbox addthis_default_style addthis_32x32_style">
            <a class="addthis_button_preferred_1"></a>
            <a class="addthis_button_preferred_2"></a>
            <a class="addthis_button_preferred_3"></a>
            <a class="addthis_button_preferred_4"></a>
            <a class="addthis_button_preferred_5"></a>
            <a class="addthis_button_preferred_6"></a>
            <a class="addthis_button_preferred_7"></a>
            <a class="addthis_button_preferred_8"></a>
            <a class="addthis_button_preferred_9"></a>
            <a class="addthis_button_compact"></a>
            <a class="addthis_counter addthis_bubble_style"></a>
        </div>
        <script type="text/javascript" src="http://s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4e43832a47612352"></script>
        <!-- AddThis Button END -->
    </div>

            <div class="comments">
                <div id="disqus_thread"></div>
                <script type="text/javascript">
                    var disqus_shortname = 'cuccode';
                    var disqus_identifier = 'incoming_bus_tracking.html';
                    var disqus_url = 'https://cuccode.com/incoming_bus_tracking.html';
                    (function() {
                        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                        dsq.src = '//cuccode.disqus.com/embed.js';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    })();
                </script>
                <noscript>Please enable JavaScript to view the comments.</noscript>
            </div>
    </div>
    <!-- Footer -->
    <footer class="bg-dark">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-4">
                    <p class="copyright">
                        Powered by <a href="http://getpelican.com">Pelican</a>, takes great advantage of <a href="http://python.org">Python</a> <br />
                        <a href="https://github.com/dangsonbk/pelicana-clean-blog">pelicana-clean-blog</a>, modified version of <a href="https://github.com/gilsondev/pelican-clean-blog">pelican-clean-blog</a> <br />
                        &copy;  dangsonbk
                    </p>
                </div>
                <div class="col-lg-8">
                    <ul class="list-inline text-center">
                            <li class="list-inline-item">
                                <a href="https://twitter.com/dangsonbk">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li class="list-inline-item">
                                <a href="https://github.com/dangsonbk">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                    </ul>
                    <ul class="list-inline text-center">
                        <a href="https://discordapp.com/invite/EeEPr6C" target="_blank"><img src="https://cuccode.com/theme/images/discord.png"></a>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

        <!-- Custom Theme JavaScript -->
        <script src="https://cuccode.com/theme/js/clean-blog.min.js"></script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-105160643-1', 'auto');
      ga('send', 'pageview');

    </script>
<script type="text/javascript">
    var disqus_shortname = 'cuccode';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
    <!-- <script>
    window.EMOJICOM_WIDGET = {
        campaign: "SmhS1wCdwJv2YJ6nosAV"
    };
</script>
<script src="https://cdn.emojicom.io/embed/widget.js" async></script>

 -->
</body>

</html>